model WorkoutPlan {
  id          String             @id @default(cuid())
  slug        String             @unique
  title       String
  description String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  days        WorkoutDay[]
  roundResults WorkoutRoundResult[]
}

model WorkoutDay {
  id          String              @id @default(cuid())
  planId      String
  plan        WorkoutPlan         @relation(fields: [planId], references: [id], onDelete: Cascade)
  dayNumber   Int
  slug        String
  title       String
  summary     String
  totalLabel  String
  tip         String?
  focus       String?
  finisher    String?
  options     String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  rounds      WorkoutRound[]
  roundResults WorkoutRoundResult[]

  @@unique([planId, dayNumber])
  @@unique([planId, slug])
  @@index([planId, dayNumber])
}

model WorkoutRound {
  id           String              @id @default(cuid())
  dayId         String
  day           WorkoutDay          @relation(fields: [dayId], references: [id], onDelete: Cascade)
  roundNumber   Int
  title         String
  targetSeconds Int
  restSeconds   Int
  notes         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  roundResults  WorkoutRoundResult[]

  @@unique([dayId, roundNumber])
  @@index([dayId, roundNumber])
}

model WorkoutRoundResult {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId        String
  plan          WorkoutPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  dayId         String
  day           WorkoutDay  @relation(fields: [dayId], references: [id], onDelete: Cascade)
  roundId       String
  round         WorkoutRound @relation(fields: [roundId], references: [id], onDelete: Cascade)
  targetSeconds Int
  elapsedMs     Int
  completedAt   DateTime    @default(now())

  @@index([planId, dayId, completedAt])
  @@index([userId, completedAt])
  @@index([roundId])
}
